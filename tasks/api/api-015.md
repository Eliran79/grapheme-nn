---
id: api-015
title: Implement A2A (Agent-to-Agent) communication protocol
status: done
priority: high
tags:
- api
- a2a
- agent
- protocol
- communication
dependencies: []
assignee: developer
created: 2025-12-11T07:45:26.516876357Z
estimate: 8h
complexity: 8
area: api
---

# Implement A2A (Agent-to-Agent) communication protocol

> **⚠️ SESSION WORKFLOW NOTICE (for AI Agents):**
>
> **This task should be completed in ONE dedicated session.**
>
> When you mark this task as `done`, you MUST:
> 1. Fill the "Session Handoff" section at the bottom with complete implementation details
> 2. Document what was changed, what runtime behavior to expect, and what dependencies were affected
> 3. Create a clear handoff for the developer/next AI agent working on dependent tasks
>
> **If this task has dependents,** the next task will be handled in a NEW session and depends on your handoff for context.

## Context
Implement Google's A2A (Agent-to-Agent) protocol for inter-agent communication. A2A enables GRAPHEME agents to discover, communicate, and delegate tasks to other agents, enabling multi-agent systems.

## Objectives
- [x] Implement A2A Agent Card for discovery
- [x] Implement JSON-RPC 2.0 based task management
- [x] Create 4 GRAPHEME skills for the agent
- [x] Support task lifecycle (create, get, cancel, list)
- [x] Pass all unit tests

## Tasks
- [x] Define AgentCard structure (/.well-known/agent.json)
- [x] Implement A2AAgent struct with task management
- [x] Create text_to_graph skill
- [x] Create graph_transform skill
- [x] Create graph_to_text skill
- [x] Create analyze_text skill
- [x] Implement task/create handler
- [x] Implement task/get handler
- [x] Implement task/cancel handler
- [x] Implement task/list handler
- [x] Implement tasks/sendMessage handler
- [x] Write comprehensive unit tests (10 tests)

## Acceptance Criteria
✅ **Criteria 1:** Agent card contains skills, capabilities, and authentication info
✅ **Criteria 2:** tasks/create executes skills and returns task with artifacts
✅ **Criteria 3:** tasks/get retrieves task by ID
✅ **Criteria 4:** tasks/list returns all tasks with optional filtering
✅ **Criteria 5:** All 10 unit tests pass

## Technical Notes
- Uses serde_json for JSON-RPC serialization
- Tasks stored in HashMap with string IDs
- Task status: Pending, Running, Completed, Failed, Cancelled, InputRequired
- Supports multimodal content (text, file, data)
- Ready for HTTP server integration (actix-web, axum)

## Testing
- [x] Write unit tests for new functionality (10 tests)
- [x] Ensure all tests pass before marking task complete
- [x] Consider edge cases and error conditions

## Version Control
- [x] Build passes: `cargo build -p grapheme-train`
- [x] Tests pass: `cargo test -p grapheme-train a2a_protocol`

## Updates
- 2025-12-11: Task created
- 2025-12-11: Task completed - A2A protocol implemented with 4 skills, 10 tests passing

## Session Handoff (AI: Complete this when marking task done)
**For the next session/agent working on dependent tasks:**

### What Changed
- Created `/data/git/Guard8.ai/grapheme-nn/grapheme-train/src/a2a_protocol.rs` (~700 lines)
- Added module declaration to `lib.rs`: `pub mod a2a_protocol;`
- Implemented Google's A2A protocol for GRAPHEME

**New structures:**
- `AgentCard` - Agent discovery metadata (/.well-known/agent.json)
- `AuthenticationInfo`, `OAuth2Config` - Auth configuration
- `AgentCapabilities` - Streaming, push notifications, concurrency
- `Skill` - Agent skill definition with JSON schemas
- `Task`, `TaskStatus` - Task lifecycle management
- `A2AMessage`, `ContentPart` - Multimodal messages
- `Artifact`, `ArtifactContent` - Task outputs
- `A2ARequest`, `A2AResponse`, `A2AError` - JSON-RPC protocol
- `A2AAgent` - Main agent server

**4 GRAPHEME skills:**
1. `text_to_graph` - Convert text to GraphemeGraph
2. `graph_transform` - Apply transformations (simplify, expand, summarize)
3. `graph_to_text` - Convert graph back to text
4. `analyze_text` - Analyze text (sentiment, entities, structure, summary)

**Helper functions:**
- `generate_agent_json()` - Generate discovery document
- `parse_request()` - Parse incoming JSON-RPC
- `serialize_response()` - Serialize outgoing JSON-RPC

### Causality Impact
- Tasks have lifecycle: Pending -> Running -> Completed/Failed/Cancelled
- Each task tracks context (messages) and artifacts (outputs)
- Skills execute synchronously (production would be async)
- Task counter increments per agent instance

### Dependencies & Integration
- No new external dependencies
- Integrates with `grapheme_core::GraphemeGraph`
- Complementary to MCP server (api-017):
  - MCP = internal tools/resources (vertical)
  - A2A = external agent communication (horizontal)
- Ready for HTTP server integration

### Verification & Testing
```bash
# Run A2A protocol tests
cargo test -p grapheme-train a2a_protocol

# All 10 tests pass:
# - test_agent_creation
# - test_agent_card
# - test_agent_info_request
# - test_task_create
# - test_task_get
# - test_task_not_found
# - test_task_list
# - test_unknown_method
# - test_unknown_skill
# - test_generate_agent_json
```

### Context for Next Task
- A2A agent is ready for HTTP deployment
- Use `generate_agent_json()` for `/.well-known/agent.json` endpoint
- Skills can be extended by adding to `card.skills` vector
- Tasks support streaming via SSE (capability declared, implementation TBD)
- Consider adding persistent task storage for production
- The `A2AMessage` type is renamed from `Message` to avoid conflict with llm_client::Message
